<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title> • Clojure Usage</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/atom-one-dark.css" /><script type="text/javascript" src="highlight/highlight.pack.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with the <a href="https://github.com/clojang/codox-theme">Clojang UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">CMR Client</span> <span class="project-version">0.3.0-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="0000-background.html"><div class="inner"><span>Background</span></div></a></li><li class="depth-1 "><a href="1000-api-overview.html"><div class="inner"><span>CMR API Overview</span></div></a></li><li class="depth-1 "><a href="2000-dev-status.html"><div class="inner"><span>Status</span></div></a></li><li class="depth-1 "><a href="3000-guides.html"><div class="inner"><span>Guides</span></div></a></li><li class="depth-1  current"><a href="3010-clojure-usage.html"><div class="inner"><span> • Clojure Usage</span></div></a></li><li class="depth-1 "><a href="3020-clojurescript-usage.html"><div class="inner"><span> • ClojureScript Usage</span></div></a></li><li class="depth-1 "><a href="3030-javascript-usage.html"><div class="inner"><span> • JavaScript Usage</span></div></a></li><li class="depth-1 "><a href="9000-development.html"><div class="inner"><span>Development</span></div></a></li><li class="depth-1 "><a href="9100-contributing.html"><div class="inner"><span> • Contributing</span></div></a></li><li class="depth-1 "><a href="9900-license.html"><div class="inner"><span>License</span></div></a></li><li class="depth-1 "><a href="9999-versions.html"><div class="inner"><span>Other Versions</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cmr</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></div></li><li class="depth-3"><a href="cmr.client.ac.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ac</span></div></a></li><li class="depth-4 branch"><a href="cmr.client.ac.impl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>impl</span></div></a></li><li class="depth-4"><a href="cmr.client.ac.protocol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocol</span></div></a></li><li class="depth-3"><a href="cmr.client.base.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>base</span></div></a></li><li class="depth-4 branch"><a href="cmr.client.base.impl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>impl</span></div></a></li><li class="depth-4"><a href="cmr.client.base.protocol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocol</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>common</span></div></div></li><li class="depth-4 branch"><a href="cmr.client.common.const.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>const</span></div></a></li><li class="depth-4"><a href="cmr.client.common.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-3 branch"><a href="cmr.client.dev.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>dev</span></div></a></li><li class="depth-3"><a href="cmr.client.graph.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>graph</span></div></a></li><li class="depth-4 branch"><a href="cmr.client.graph.impl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>impl</span></div></a></li><li class="depth-4"><a href="cmr.client.graph.protocol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocol</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>http</span></div></div></li><li class="depth-4 branch"><a href="cmr.client.http.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-4 branch"><a href="cmr.client.http.impl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>impl</span></div></a></li><li class="depth-4 branch"><a href="cmr.client.http.protocol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocol</span></div></a></li><li class="depth-4"><a href="cmr.client.http.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-3"><a href="cmr.client.ingest.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>ingest</span></div></a></li><li class="depth-4 branch"><a href="cmr.client.ingest.impl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>impl</span></div></a></li><li class="depth-4"><a href="cmr.client.ingest.protocol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocol</span></div></a></li><li class="depth-3"><a href="cmr.client.search.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>search</span></div></a></li><li class="depth-4 branch"><a href="cmr.client.search.impl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>impl</span></div></a></li><li class="depth-4"><a href="cmr.client.search.protocol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocol</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>testing</span></div></div></li><li class="depth-4 branch"><a href="cmr.client.testing.data.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data</span></div></a></li><li class="depth-4"><a href="cmr.client.testing.runner.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>runner</span></div></a></li><li class="depth-3"><a href="cmr.client.tests.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>tests</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></div></li><li class="depth-5 branch"><a href="cmr.client.tests.common.const.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>const</span></div></a></li><li class="depth-5"><a href="cmr.client.tests.common.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#clojure-usage" name="clojure-usage"></a> • Clojure Usage</h1>
<p>Fire up the dev REPL:</p>
<pre><code class="bash">$ lein repl
</code></pre>
<p>Create some clients:</p>
<pre><code class="clj">(def ingest-client (ingest/create-client))
(def search-client (search/create-client))
</code></pre>
<p>Get a list of providers:</p>
<pre><code class="clj">(def results (ingest/get-providers ingest-client))
(pprint results)
</code></pre>
<pre><code class="clj">{:request-time 1007,
 :repeatable? false,
 :protocol-version {:name "HTTP", :major 1, :minor 1},
 :streaming? true,
 :chunked? false,
 :reason-phrase "OK",
 :headers
 {"CMR-Request-Id" "5b2b1090-bd3f-4776-a903-168c34f7a44c",
  "Content-Type" "application/json; charset=utf-8",
  "Date" "Sun, 27 Aug 2017 06:25:06 GMT",
  "Server" "nginx",
  "Strict-Transport-Security" "max-age=31536000; includeSubDomains;",
  "Vary" "Accept-Encoding, User-Agent",
  "Connection" "keep-alive"},
 :orig-content-encoding nil,
 :status 200,
 :length -1,
 :body
 [{:provider-id "LARC_ASDC",
   :short-name "LARC_ASDC",
   :cmr-only false,
   :small false}
   ...]}
</code></pre>
<p>Or, if you just want the body:</p>
<pre><code class="clj">(def ingest-client (ingest/create-client {:return-body? true}))
(def results (ingest/get-providers client))
(pprint results)
</code></pre>
<pre><code class="clj">[{:provider-id "LARC_ASDC",
  :short-name "LARC_ASDC",
  :cmr-only false,
  :small false}
 {:provider-id "USGS_EROS",
  :short-name "USGS_EROS",
  :cmr-only true,
  :small false}
 ...]
</code></pre>
<p>Note that a subequent release of the CMR client will support changing the <code>:return-body?</code> value on a per-call basis and won’t require instantiating a new client.</p>
<p>Run against a local instance instead of production:</p>
<pre><code class="clj">(def ingest-client (ingest/create-client {:endpoint :local :return-body? true}))
(def results (ingest/get-providers ingest-client))
(pprint results)
</code></pre>
<p>Create a collection:</p>
<pre><code class="clj">(def authed-ingest-client (ingest/create-client {:endpoint :local
                                                 :token "mock-echo-system-token"
                                                 :return-body? true}))
(def xml-file "/Users/dmcgregg/lab/NASA/CMR/cmr-edsc-stubs/resources/data/collections/GES_DISC/AIRX3STD_006.xml")
(def results (ingest/create-collection authed-ingest-client
                                       "GES_DISC"
                                       "coll-native-id"
                                       (slurp xml-file)
                                       {:content-type "application/echo10+xml"
                                        :accept "application/json"}))
(print results)
</code></pre>
<p>Check the collection:</p>
<pre><code class="clj">(def results (search/get-collections search-client {:accept "application/json"}))
</code></pre>
<p>Create a variable:</p>
<pre><code class="clj">(def json-file "/Users/dmcgregg/lab/NASA/CMR/cmr-edsc-stubs/resources/data/variables/GES_DISC/AIRX3STD/CH4/CH4_VMR_A.json")
(def submit-content-type "application/vnd.nasa.cmr.umm+json;version=1.0; charset=UTF-8")
(def accept-content-type "application/json")
(def results (ingest/create-variable authed-ingest-client
                                     "GES_DISC"
                                     "var-native-id"
                                     (slurp json-file)
                                     {:content-type submit-content-type
                                      :accept accept-content-type}))
(or (pprint (:errors results)) (pprint results))
</code></pre>
<p>Associate a variable with a collection:</p>
<pre><code class="clj">(require '[clojure.data.json :as json])
(def authed-search-client (search/create-client {:endpoint :local
                                                 :token "mock-echo-system-token"
                                                 :return-body? true}))
(def submit-content-type "application/json")
(def accept-content-type "application/json")
(def results (search/create-variable-association
              authed-search-client
              "V1200000117-GES_DISC"
              (json/write-str
               [{:concept_id "C1200000100-GES_DISC"}])
              {:content-type submit-content-type
               :accept accept-content-type}))
(or (pprint (:errors results)) (pprint results))
</code></pre>
<p>curl -XPOST -i \  -H “Content-Type: application/json” \  -H “Echo-Token: mock-echo-system-token” \  <a href="http://localhost:3003/variables/V1200000117-GES_DISC/associations">http://localhost:3003/variables/V1200000117-GES_DISC/associations</a> \  -d ‘[{“concept_id”: “C1200000100-GES_DISC”}]’</p>
<p>For example usage of the Access Control service, we’ll use a client that defines it’s default endpoint and token ahead of time, so we don’t have to pass them in every call:</p>
<pre><code class="clj">(def ac-client (ac/create-client {:endpoint :sit :token (slurp "path/to/tokens/sit")}))
</code></pre>
<p>To check if and what ingest management permissions are granted:</p>
<pre><code class="clj">(-&gt; ac-client
    (ac/get-permissions
     {:user_id "my_urs_username"
      :system_object "INGEST_MANAGEMENT_ACL"} {})
    :body)
</code></pre>
<pre><code class="clj">{:INGEST_MANAGEMENT_ACL ["read" "update"]}
</code></pre>
<p>To see what permissions are granted for a particular concept-id:</p>
<pre><code class="clj">(-&gt; ac-client
    (ac/get-permissions
     {:user_id "my_urs_username"
      :concept_id "C1200187767-EDF_OPS"} {})
    :body)
</code></pre>
<pre><code class="clj">{:C1200187767-EDF_OPS ["read" "update" "delete" "order"]}
</code></pre>
<p>To look up the user id by token:</p>
<pre><code class="clj">(ac/token-&gt;user ac-client)
</code></pre>
<pre><code class="clj">"my_urs_username"
</code></pre>
<p>Which means you can make the other calls, even if you don’t have the user’s id:</p>
<pre><code class="clj">(-&gt; ac-client
    (ac/get-permissions
     {:user_id (ac/token-&gt;user ac-client)
      :concept_id "C1200187767-EDF_OPS"} {})
    :body)
</code></pre>
<pre><code class="clj">{:C1200187767-EDF_OPS ["read" "update" "delete" "order"]}
</code></pre>
<p>Note, however, that this is making two separate REST calls: one to the legacy services endpoint, and the other to the access control endpoint.</p></div></div></div></body></html>